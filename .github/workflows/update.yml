name: Update S&P 500 Data

on:
  schedule:
    # -------------------------------------------------------
    # CRON : C'est ici que se r√®gle l'automatisation
    # Minute (30) | Heure (22) | Jour (*) | Mois (*) | JourSemaine (1-5)
    # 22h30 UTC = 23h30 ou 00h30 en France selon la saison
    # '1-5' signifie du Lundi au Vendredi. 
    # Mettez '*' √† la place de '1-5' pour le lancer le week-end aussi.
    # -------------------------------------------------------
    - cron: '30 22 * * 1-5'
  
  # Permet de lancer manuellement le script via un bouton si besoin
  workflow_dispatch:

permissions:
  contents: write

jobs:
  run-bots:
    runs-on: ubuntu-latest

    steps:
      - name: R√©cup√©ration du code
        uses: actions/checkout@v4

      - name: Configuration Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Installation des librairies
        run: |
          pip install yfinance pandas numpy requests lxml

      # --- Lancement du Bot 1 (Pullback - S√©curit√©) ---
      - name: Ex√©cution Strat√©gie Pullback
        run: python bots/bot_sp500.py

      # --- Lancement du Bot 2 (Phoenix - Breakout) ---
      - name: Ex√©cution Strat√©gie Phoenix
        run: python bots/bot_sp500_breakout.py

      # --- Sauvegarde des r√©sultats sur le site ---
      - name: Commit et Push des fichiers JSON
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add data/*.json
          # Le "|| exit 0" emp√™che l'erreur si aucun fichier n'a chang√© (ex: jours f√©ri√©s)
          git commit -m "üìà Auto-update: S&P 500 Strategies" || exit 0
          git push
